
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="author" content="">
<link rel="shortcut icon" href="assets/ico/favicon.ico">

<title>Bacon</title>

<!-- Bootstrap core CSS -->
<link href="css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="css/highlight/styles/default.css">
<link rel="stylesheet" href="css/slider/slider.css">

<!-- Custom styles for this template -->
<link href="css/dashboard.css" rel="stylesheet">
<link href="css/graph.css" rel="stylesheet">

<!-- Just for debugging purposes. Don't actually copy this line! -->
<!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->

<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body>

	<div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
		<div class="container-fluid">
			<div class="navbar-header">
<!-- 				<button type="button" class="navbar-toggle" data-toggle="collapse" -->
<!-- 					data-target=".navbar-collapse"> -->
<!-- 					<span class="sr-only">Toggle navigation</span> <span -->
<!-- 						class="icon-bar"></span> <span class="icon-bar"></span> <span -->
<!-- 						class="icon-bar"></span> -->
<!-- 				</button> -->
				<a class="navbar-brand" href="#">Bacon</a>
			</div>
			<div class="navbar-collapse collapse">
				<ul class="nav navbar-nav navbar-right">
					<!--             <li><a href="#">Dashboard</a></li> -->
					<!--             <li><a href="#">Settings</a></li> -->
					<!--             <li><a href="#">Profile</a></li> -->
					<!--             <li><a href="#">Help</a></li> -->
				</ul>
				<form class="navbar-form navbar-right">
					<input type="text" class="form-control" placeholder="Search...">
				</form>
			</div>
		</div>
	</div>

	<div class="container-fluid">
		<div class="row"></div>
	</div>
	<div class="col-sm-9 col-sm-offset-3 col-md-6 col-md-offset-0 main">
<!-- 		<div> -->
<!-- 			TensÃ£o: <input style="position: relative; top: 3px;" type="range" -->
<!-- 			min="0" max="100" value="85"> -->
<!-- 		</div> -->
		<input id="ex1" data-slider-id='ex1Slider' type="text" data-slider-min="0" data-slider-max="100" data-slider-step="1" data-slider-value="14"/>
		<div id="canvas" class="col-sm-9 col-sm-offset-5 col-md-5 col-md-offset-0 main"></div>
	</div>
	<div class="col-sm-3 col-md-6 col-md-offset-6 sidebar">
		<ul class="pagination">
<!-- 		  <li class="disabled"><a href="#">&laquo;</a></li> -->
<!-- 		  <li class="active"><a href="#">1 <span class="sr-only">(current)</span></a></li> -->
		</ul>
		<div class="panel panel-default">
		  <div id="bacon-location" class="panel-body">
		  </div>
		</div>
		<pre style="background: white;"><code id="bacon-code"></code></pre>
	</div>


		<!-- Bootstrap core JavaScript
    ================================================== -->
		<!-- Placed at the end of the document so the pages load faster -->
		<script
			src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
		<script src="js/bootstrap.min.js"></script>
		<script src="js/docs.min.js"></script>
		<script type="text/javascript" src="js/d3/d3.js"></script>
		<script type="text/javascript" src="js/d3/d3.layout.js"></script>
		<script type="text/javascript" src="js/packages.js"></script>
		<script type="text/javascript">
		
			function showOccurrences(el) {
				$.get("ws/concepts/" + el.key + "/occurrences", function(data) {
					var value = hljs.highlight("java", data[0].full_resource);
					$("#bacon-code").html(value.value);
					$("#bacon-location").html(data[0].location);
	
					$(".pagination").html("");
					for(var i = 0; i < data.length; i++) {
						$(".pagination").append('<li class="active"><a href="#">'+(i+1)+' <span class="sr-only">(current)</span></a></li>');
					}
				});
				//$('#bacon-code').each(function(i, e) {hljs.highlightBlock(e, "java")});
			}

			var w = 800, h = 800, rx = w / 2, ry = h / 2, m0, rotate = 0;

			var splines = [];

			var cluster = d3.layout.cluster().size([ 360, ry - 120 ]).sort(
					function(a, b) {
						return d3.ascending(a.key, b.key);
					});

			var bundle = d3.layout.bundle();

			var line = d3.svg.line.radial().interpolate("bundle").tension(.85)
					.radius(function(d) {
						return d.y;
					}).angle(function(d) {
						return d.x / 180 * Math.PI;
					});

			// Chrome 15 bug: <http://code.google.com/p/chromium/issues/detail?id=98951>
			var div = d3.select("#canvas").insert("div", "h2")
// 						    .style("top", "-80px")
// 						    .style("left", "-160")
						    .style("width", w + "px")
						    .style("height", w + "px")
						    .style("position", "absolute")
			.style("-webkit-backface-visibility", "hidden");

			var svg = div.append("svg:svg").attr("width", w).attr("height", w)
					.append("svg:g").attr("transform",
							"translate(" + rx + "," + ry + ")");

			svg.append("svg:path").attr("class", "arc").attr(
					"d",
					d3.svg.arc().outerRadius(ry - 120).innerRadius(0)
							.startAngle(0).endAngle(2 * Math.PI)).on(
					"mousedown", mousedown);

			d3
					.json(
							"ws/concepts",
							function(classes) {
								var nodes = cluster.nodes(packages
										.root(classes)), links = packages
										.imports(nodes), splines = bundle(links);

								var path = svg.selectAll("path.link").data(
										links).enter().append("svg:path").attr(
										"class",
										function(d) {
											return "link source-"
													+ d.source.key + " target-"
													+ d.target.key;
										}).attr("d", function(d, i) {
									return line(splines[i]);
								});

								svg.selectAll("g.node").data(
										nodes.filter(function(n) {
											return !n.children;
										})).enter().append("svg:g").attr(
										"class", "node").attr("id",
										function(d) {
											return "node-" + d.key;
										})
										.attr(
												"transform",
												function(d) {
													return "rotate("
															+ (d.x - 90)
															+ ")translate("
															+ d.y + ")";
												}).append("svg:text").attr(
												"dx", function(d) {
													return d.x < 180 ? 8 : -8;
												}).attr("dy", ".31em").attr(
												"text-anchor",
												function(d) {
													return d.x < 180 ? "start"
															: "end";
												}).attr(
												"transform",
												function(d) {
													return d.x < 180 ? null
															: "rotate(180)";
												}).text(function(d) {
											return d.key;
										}).on("mouseover", mouseover).on(
												"mouseout", mouseout).on(
												"click", showOccurrences);

								$('#ex1').slider()
								  .on('slide', function(ev){
									  line.tension($(this).data('slider').getValue() / 100);
										path.attr("d", function(d, i) {
											return line(splines[i]);
										});
								  });
								
// 								d3.select("input[type=range]").on("change",
// 										function() {
// 											line.tension(this.value / 100);
// 											path.attr("d", function(d, i) {
// 												return line(splines[i]);
// 											});
// 										});
							});

			d3.select(window).on("mousemove", mousemove).on("mouseup", mouseup);

			function mouse(e) {
				return [ e.pageX - rx, e.pageY - ry ];
			}

			function mousedown() {
				m0 = mouse(d3.event);
				d3.event.preventDefault();
			}

			function mousemove() {
				if (m0) {
					var m1 = mouse(d3.event), dm = Math.atan2(cross(m0, m1),
							dot(m0, m1))
							* 180 / Math.PI;
					div.style("-webkit-transform", "translateY(" + (ry - rx)
							+ "px)rotateZ(" + dm + "deg)translateY("
							+ (rx - ry) + "px)");
				}
			}

			function mouseup() {
				if (m0) {
					var m1 = mouse(d3.event), dm = Math.atan2(cross(m0, m1),
							dot(m0, m1))
							* 180 / Math.PI;

					rotate += dm;
					if (rotate > 360)
						rotate -= 360;
					else if (rotate < 0)
						rotate += 360;
					m0 = null;

					div.style("-webkit-transform", null);

					svg.attr(
							"transform",
							"translate(" + rx + "," + ry + ")rotate(" + rotate
									+ ")").selectAll("g.node text").attr("dx",
							function(d) {
								return (d.x + rotate) % 360 < 180 ? 8 : -8;
							}).attr("text-anchor", function(d) {
						return (d.x + rotate) % 360 < 180 ? "start" : "end";
					}).attr(
							"transform",
							function(d) {
								return (d.x + rotate) % 360 < 180 ? null
										: "rotate(180)";
							});
				}
			}

			function mouseover(d) {
				svg.selectAll("path.link.target-" + d.key).classed("target",
						true).each(updateNodes("source", true));

				svg.selectAll("path.link.source-" + d.key).classed("source",
						true).each(updateNodes("target", true));
			}

			function mouseout(d) {
				svg.selectAll("path.link.source-" + d.key).classed("source",
						false).each(updateNodes("target", false));

				svg.selectAll("path.link.target-" + d.key).classed("target",
						false).each(updateNodes("source", false));
			}

			function updateNodes(name, value) {
				return function(d) {
					if (value)
						this.parentNode.appendChild(this);
					svg.select("#node-" + d[name].key).classed(name, value);
				};
			}

			function cross(a, b) {
				return a[0] * b[1] - a[1] * b[0];
			}

			function dot(a, b) {
				return a[0] * b[0] + a[1] * b[1];
			}
		</script>
	
		<script src="js/bootstrap-slider.js"></script>
		<script type="text/javascript">
			$('#ex1').slider({
				formater: function(value) {
					return 'Current value: ' + value;
				}
			});
// 			  .on('slide', function(ev){
// 			   	console.log('slide');
// 			  });
// 			hljs.initHighlightingOnLoad();
		</script>
		<script src="js/highlight.pack.js"></script>
		<script type="text/javascript">
			hljs.configure({
				classPrefix : '',
				language : 'java'
			});
// 			hljs.initHighlightingOnLoad();
		</script>
</body>
</html>
